{% extends 'base.html' %}

{% block title %}Event Simulator{% endblock %}

{% block content %}
<section>
    <h1>Event Simulator</h1>
    <p class="muted">Send simulated VEX TM events to the system.</p>

    <div class="card">
        <div class="card-body">
            <form id="simulate-form">
                <div class="form-group">
                    <label for="event_type">Event Type</label>
                    <select id="event_type" name="event_type" required>
                        <option value="matchStarted">matchStarted</option>
                        <option value="matchStopped">matchStopped</option>
                        <option value="fieldMatchAssigned">fieldMatchAssigned</option>
                        <option value="audienceDisplayChanged">audienceDisplayChanged</option>
                        <option value="fieldActivated">fieldActivated</option>
                        <option value="fieldDeactivated">fieldDeactivated</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="field">Field ID</label>
                    <input type="number" id="field" name="field" placeholder="e.g., 1">
                </div>

                <div class="form-group">
                    <label for="match">Match Name</label>
                    <input type="text" id="match" name="match" placeholder="e.g., 21, 56">
                </div>

                <div class="form-group">
                    <label for="round">Round</label>
                    <input type="text" id="round" name="round" placeholder="e.g., QUAL, FINALS">
                </div>

                <div class="form-group">
                    <label for="display">Display</label>
                    <input type="text" id="display" name="display" placeholder="e.g., IN_MATCH, RANKINGS">
                </div>

                <button type="submit">Send Event</button>
            </form>
        </div>
    </div>

    <div id="response-container" class="card" style="display: none; margin-top: 1.5rem;">
        <div class="card-header">Response</div>
        <div class="card-body">
            <pre><code id="response-content"></code></pre>
        </div>
    </div>
</section>

<script>
document.getElementById('simulate-form').addEventListener('submit', async function(e) {
    e.preventDefault();

    const form = e.target;
    const formData = new FormData(form);
    const data = Object.fromEntries(formData.entries());

    // Filter out empty values
    for (let key in data) {
        if (data[key] === '') {
            delete data[key];
        }
    }

    const responseContainer = document.getElementById('response-container');
    const responseContent = document.getElementById('response-content');

    try {
        const response = await fetch('/api/simulate_event_from_web', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify(data),
        });

        const result = await response.json();
        responseContent.textContent = JSON.stringify(result, null, 2);
        responseContainer.style.display = 'block';

    } catch (error) {
        responseContent.textContent = `Error: ${error.message}`;
        responseContainer.style.display = 'block';
    }
});
</script>
{% endblock %}
